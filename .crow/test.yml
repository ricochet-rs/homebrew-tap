---
when:
  - event: [pull_request, tag]
  - event: [push, manual]
    branch:
      - ${CI_REPO_DEFAULT_BRANCH}

labels:
  type: static

variables:
  - &brew_image reg.ricochet.rs/docker.io/homebrew/brew:4.6.16
  - &brew_base
    depends_on: []
    environment:
      HOMEBREW_COLOR: "true"
      HOMEBREW_DEVELOPER: "true"
      HOMEBREW_NO_AUTO_UPDATE: "True"
      HOMEBREW_NO_ENV_HINTS: "True"

steps:
  - name: test-ricochet
    image: *brew_image
    <<: *brew_base
    commands:
      - chmod o-w ./Formula/ricochet.rb
      - brew style ./Formula/ricochet.rb
      - brew install ./Formula/ricochet.rb
      - brew test ./Formula/ricochet.rb
